---
default_context:
  owner: test
  repo: test
  pr:
    base_ref_name: main
    head_ref_name: feature/changes
  team_members:
    test/team-alpha:
    - alpha-alice
    - alpha-bob
    - alpha-charlie
    test/team-beta:
    - beta-alice
    - beta-bob
    - beta-charlie
test_cases:
- name: Pass policy when team alpha files change and team alpha approves
  context:
    files_changed:
    - team-alpha/file.txt
    pr:
      author: alpha-alice
    reviews:
    - author: alpha-bob
      state: approved
  assert:
    evaluation_status: approved
    must_be_approved:
    - team-alpha-review

- name: Fail policy when team alpha files change and only PR author approves
  context:
    files_changed:
    - team-alpha/file.txt
    pr:
      author: alpha-alice
    reviews:
    - author: alpha-alice
      state: approved
  assert:
    evaluation_status: pending
    must_be_pending:
    - team-alpha-review

- name: Pass policy when multiple team files are changing with multiple team approvals
  context:
    files_changed:
    - team-alpha/file.txt
    - team-beta/file.txt
    pr:
      author: alpha-alice
    reviews:
    - author: alpha-bob
      state: approved
    - author: beta-charlie
      state: approved
  assert:
    evaluation_status: approved
    must_be_approved:
    - team-alpha-review
    - team-beta-review


- name: Fail policy when multiple team files are changing with review missing from beta team
  context:
    files_changed:
    - team-alpha/file.txt
    - team-beta/file.txt
    pr:
      author: alpha-alice
    reviews:
    - author: alpha-bob
      state: approved
  assert:
    evaluation_status: pending
    must_be_approved:
    - team-alpha-review
    must_be_pending:
    - team-beta-review
