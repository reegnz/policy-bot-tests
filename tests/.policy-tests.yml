---
default_context:
  owner: test
  repo: test
  pr:
    base_ref_name: main
    head_ref_name: feature/changes
  team_members:
    test/team-alpha:
    - alpha-alice
    - alpha-bob
    - alpha-charlie
    test/team-beta:
    - beta-alice
    - beta-bob
    - beta-charlie
test_cases:
- name: Pass policy when team alpha files change and team alpha approves
  context:
    files_changed:
    - team-alpha/file.txt
    author: alpha-alice
    reviews:
    - author: alpha-bob
      state: approved
  assert:
    evaluation_status: approved
    must_be_approved:
    - team-alpha-review

- name: Fail policy when team alpha files change and only PR author approves
  context:
    files_changed:
    - team-alpha/file.txt
    author: alpha-alice
    reviews:
    - author: alpha-alice
      state: approved
  assert:
    evaluation_status: pending
    must_be_pending:
    - team-alpha-review

- name: Pass policy when multiple team files are changing with multiple team approvals
  context:
    files_changed:
    - team-alpha/file.txt
    - team-beta/file.txt
    author: alpha-alice
    reviews:
    - author: alpha-bob
      state: approved
    - author: beta-charlie
      state: approved
  assert:
    evaluation_status: approved
    must_be_approved:
    - team-alpha-review
    - team-beta-review


- name: Fail policy when multiple team files are changing with review missing from beta team
  context:
    files_changed:
    - team-alpha/file.txt
    - team-beta/file.txt
    author: alpha-alice
    reviews:
    - author: alpha-bob
      state: approved
  assert:
    evaluation_status: pending
    must_be_approved:
    - team-alpha-review
    must_be_pending:
    - team-beta-review

- name: Comment approval by team alpha allowed
  context:
    files_changed:
    - comment-approval-allowed/somefile.txt
    comments:
     - author: alpha-alice
       body: "I approve this change"
  assert:
    evaluation_status: approved
    must_be_approved:
    - comment-approval-alpha

- name: Comment approval by team beta disallowed
  context:
    files_changed:
    - comment-approval-allowed/somefile.txt
    comments:
     - author: beta-alice
       body: "I approve this change"
  assert:
    evaluation_status: pending
    must_be_pending:
    - comment-approval-alpha

- name: Approved with expected custom property
  context:
    custom_properties:
      approve_me:
        string: "yes"
  assert:
    evaluation_status: approved
    must_be_approved:
    - approve with magic property

- name: Skip with missing expected custom property
  context:
    custom_properties:
      approve_me:
        string: "no"
  assert:
    evaluation_status: skipped
    must_be_skipped:
    - approve with magic property